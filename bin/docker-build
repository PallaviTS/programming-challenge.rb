#!/usr/bin/env bash
set -x # echo on

# Usage
#
# bin/docker-build
# bin/docker-build sqlserver
# bin/docker-build mysql

# IMAGE=${IMAGE:-"docker-prod.fidor.intern:5000/fidor/adib_xpress_finance"}
IMAGE=${IMAGE:-"adib_xpress_finance"}
BRANCH=${BRANCH:-"$(git rev-parse --abbrev-ref HEAD | tr / -)"}
VERSION=${VERSION:-"$(date +%Y%m%d%H%M%S)"}

# build
docker build \
  -t $IMAGE \
  --build-arg DB=${1:-sqlserver} \
  .

# tag
docker tag $IMAGE $IMAGE:$BRANCH
docker tag $IMAGE $IMAGE:$BRANCH-$VERSION

# push
# docker push $IMAGE:${BRANCH}
# docker push $IMAGE:${BRANCH}-$VERSION
